services:
  - type: worker
    name: binance-bot
    env: python
    buildCommand: |
      apt-get update
      apt-get install -y wget unzip
      # Install boringtun (userspace WireGuard dataplane)
      wget https://github.com/cloudflare/boringtun/releases/download/0.4.0/boringtun-linux-x86_64.zip -O bt.zip
      unzip bt.zip
      mv boringtun /usr/local/bin/
      
      # Install wireguard-go (userspace WireGuard controller)
      wget https://github.com/WireGuard/wireguard-go/releases/download/v0.0.20220316/wireguard-go-linux-amd64 -O /usr/local/bin/wireguard-go
      chmod +x /usr/local/bin/wireguard-go

      pip install -r requirements.txt

    startCommand: |
      export WG_QUICK_USERSPACE_IMPLEMENTATION=boringtun
      export WG_QUICK_USE_WIREGUARD_GO=1
      cp wg0.conf /tmp/wg0.conf
      cp wg-quick /usr/local/bin/wg-quick
      chmod +x /usr/local/bin/wg-quick
      
      echo "Starting WireGuard..."
      wg-quick up wg0
      
      echo "VPN connected. Checking IP..."
      curl https://ifconfig.me
      
      echo "Starting bot..."
      python ultra_precision_realtime_bot_render.py
